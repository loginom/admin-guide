# Установка Loginom Adapter

Имя установочного файла состоит из названия и версии продукта: `LoginomAdapter_6.x.x.msi`, где 6.x.x — цифры, обозначающие версию и релиз программы.

> **Примечание:** Версия *Loginom Adapter* должна соответствовать версии используемого сервера Loginom.

При запуске программы установщика *Адаптера* может появится информационное окно с сообщением: `отсутствуют необходимые права… Войдите в систему под именем администратора…`. В этом случае следует запустить установщик из командной строки (**command prompt**), запущенной от имени администратора (ПКМ по ярлыку командной строки, после чего выбрать **Run as Administrator**).

## Установка MSI

Если во время подготовки все было настроено верно, появится окно установщика.

В окне **Выбрать адрес для установки** назначаем следующие значения параметров (данные параметры настраиваются в IIS Manager):

* **Веб-узел** — оставляем без изменений Default Web Site (при установке по умолчанию);
* **Виртуальный каталог** — LoginomAdapter;
* **Пул приложений** — выбираем созданный ранее AdapterAppPool.

При таких параметрах установка *Адаптера* осуществляется в каталог размещения виртуальной папки *LoginomAdapter* веб-узла «Default Web Site». При настройках IIS «по умолчанию» каталогом установки является `C:\inetpub\wwwroot\LoginomAdapter\`.

После инсталляции *Адаптера* в каталоге установки будут размещены:

1. **Service.svc** — для регистрации WSP в качестве веб-сервиса в IIS.
1. **Web.config** — конфигурационный файл веб-сервиса в формате xml, содержащий настройки подключений к внешним веб-сервисам.
1. **wsdl.url** — ссылка на Wsdl сервиса, содержит адрес: `http://localhost/LoginomAdapter/Service.svc?wsdl`.
1. **bin\\** — директория содержащая библиотеки и их настройки:
   * ~~CodeStorage32.dll.~~
   * ~~CodeStorage64.dll.~~
   * ~~Core.dll.~~
   * ~~WebServiceProxyIIS.dll.~~
   * ~~WebServiceProxyIIS.InstallState.~~
   * ~~WebServiceProxyInstallHelper.dll.~~
   * ~~WebServiceProxyInstallHelper.InstallState.~~
1. **Configurator\\** — директория содержащая программу настройки *Адаптера*:
   * **LoginomAdapterConfigurator.exe** — программа настройки *Адаптера*.

## Добавление подключений к внешним сервисам

Помимо предустановленных в процессе инсталляции папок и файлов, в процессе настройки *Адаптера* в каталоге установки могут быть размещены дополнительные файлы (сертификаты, XSD-схемы и т.п.), необходимые для работы с внешними сервисами.

Вместе с *Адаптером* могут поставляться настройки подключений (коннекторы) к таким внешним сервисам, как, например, *EquifaxFPS*, *NationalHunter*, *NBCH*, *OKB*, *QiwiScoring* и другим. Как правило, дополнительные файлы этих настроек размещаются в подкаталогах **Data** и **Certificates** каталога установки. В файле `Web.config` при этом будут содержаться ссылки на эти файлы.

Пример структуры дополнительных файлов и папок, расположенных в каталоге установки `C:\inetpub\wwwroot\LoginomAdapter\`:

* **Certificates\\** — папка с сертификатами для подключения к веб-сервисам;
* **Data\\** — папка, хранящая настройки подключения к отдельным веб-сервисам. Эти настройки содержаться в подпапках:
  * **EquifaxFPS** — папка с дополнительными файлами настройки подключения к *Эквифакс*;
  * **NBCH** — папка с дополнительными файлами настройки подключения к *НБКИ*.

В файле `Web.config` допустимо использование как абсолютных путей на дополнительные файлы (с указанием буквы диска), так и относительных, которые задаются относительно расположения `Web.config`.

Рекомендуется помещать дополнительные файлы в папку, в которой установлен *Адаптер*, а в файле конфигурации `Web.config` указывать к ним относительные пути. Это позволяет переносить *Адаптер* с одного компьютера на другой простым копированием папки с минимальным количеством перенастроек.

## Настройка лицензии Loginom Adapter

Для работы *Адаптера* требуется [лицензия](../../licenses/README.md), которая поставляется в виде физического USB-ключа, устанавливаемого на локальном компьютере с развернутым *Адаптером*. Для доступа *Адаптера* к локальному ключу требуется установка драйвера ключа Guardant, входящего в комплект поставки.

## Перенос приложения Loginom Adapter на другой компьютер

Перенос/копирование развернутого приложения *Адаптера* на другой компьютер можно сделать без использования дистрибутива, перенеся каталог установки ранее развернутого приложения в каталог существующего сайта IIS на другом компьютере. Если используется созданный по умолчанию сайт `DefaultWebSite`, то перенос осуществляется в папку `C:\inetpub\wwwroot`. После этого папка приложения будет отображена в оснастке IIS, в группе `сайты` -> `Default Web Site`, где ее необходимо преобразовать в приложение. Это можно сделать при помощи соответствующего пункта контекстного меню — **Преобразовать в приложение**. В открывшемся окне нужно выбрать заранее созданный пул приложений, например,  `LoginomAdapterAppPool`.

Если веб-сервис не запущен, то необходимо запустить его с помощью контекстного меню в диспетчере служб IIS. После этого wsdl описание веб-сервиса будет доступно по адресу `http://localhost/LoginomAdapter/Service.svc?wsdl`.

> Важно: Перенос приложения *Адаптера* должен осуществляться на компьютер с выполненной [Подготовкой к установке](./README.md) (см. пп. 1-4).
